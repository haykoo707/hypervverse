<!DOCTYPE html>
<html lang="hy">
<head>
  <meta charset="UTF-8">
  <title>game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      overflow: hidden;
      font-family: Arial;
      background-color: #919191;
    }
    #gameArea {
      width: 100vw;
      height: 100vh;
      position: relative;
    }
    .player {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
    }
    .dot, .trap {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      position: absolute;
      animation: float 2s infinite ease-in-out;
    }
    .trap {
      background-color: red;
    }
    @keyframes float {
      0% { transform: translateY(0); }
      50% { transform: translateY(-8px); }
      100% { transform: translateY(0); }
    }
    #score {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 20px;
      background: rgb(255, 255, 255);
      padding: 6px 12px;
      border-radius: 12px;
      z-index: 10;
    }
    #joystickWrapper {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      width: 120px;
      height: 120px;
      background: rgba(0,0,0,0.1);
      border-radius: 50%;
      touch-action: none;
      z-index: 10;
    }
    #joystickHandle {
      width: 50px;
      height: 50px;
      background: #00bbff;
      border-radius: 50%;
      position: absolute;
      top: 35px;
      left: 35px;
      transition: 0.1s;
    }
    #colorPicker {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 10;
    }
    .username {
  position: absolute;
  top: -20px;
  width: 100px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 15px;
  color: black;
  text-align: center;
  white-space: nowrap;
  font-weight: bold;
}
#exitButton {
  position: absolute;
  top: 10px;
  left: 10px;
  background: #000000;
  color: white;
  border: none;
  border-radius: 50%;
  width: 32px;
  height: 32px;
  font-weight: bold;
  font-size: 18px;
  z-index: 20;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 0 5px rgba(0,0,0,0.2);
}

  </style>
</head>
<body>
    <button id="exitButton">√ó</button>

  <input type="color" id="colorPicker" title="‘∏’∂’ø÷Ä’´÷Ä ’£’∏÷Ç’µ’∂’®" />
  <div id="score">üåü</div>
  <div id="gameArea">
    <div id="player" class="player">
      <span class="username" id="playerUsername">@Player</span>
    </div>
    
          <div id="joystickWrapper">
      <div id="joystickHandle"></div>
    </div>
  </div>
<script>
let telegramUsername = "Player";

// ’ç’ø’∏÷Ç’£’∏÷Ç’¥ ’•’∂÷Ñ ’∏÷Ä initDataUnsafe ’•÷Ç user ’∞’°’Ω’°’∂’•’¨’´ ’•’∂
if (
  typeof Telegram !== "undefined" &&
  Telegram.WebApp &&
  Telegram.WebApp.initDataUnsafe &&
  Telegram.WebApp.initDataUnsafe.user &&
  Telegram.WebApp.initDataUnsafe.user.username
) {
  telegramUsername = "@" + Telegram.WebApp.initDataUnsafe.user.username;
}

// ’è’•’≤’°’§÷Ä’∏÷Ç’¥ ’•’∂÷Ñ DOM-’´ ’¥’•’ª
document.getElementById("playerUsername").textContent = telegramUsername;
Telegram.WebApp.ready(); // ’Ω’° ’∫’°÷Ä’ø’°’§’´÷Ä ’ß
Telegram.WebApp.expand(); // ÷Å’°’∂’Ø’°’¨’´ ’ß ’¨’´’°’ß’Ø÷Ä’°’∂ ’≠’°’≤’´ ’∞’°’¥’°÷Ä
console.log(Telegram.WebApp.initDataUnsafe);



</script>
  <script>
    const player = document.getElementById('player');
    const scoreDisplay = document.getElementById('score');
    const colorPicker = document.getElementById('colorPicker');
    const gameArea = document.getElementById('gameArea');
    const joystickWrapper = document.getElementById('joystickWrapper');
    const joystickHandle = document.getElementById('joystickHandle');

    let userScore = parseInt(localStorage.getItem('userScore')) || 0;
    scoreDisplay.textContent = `üåü ${userScore}`;

    let x = window.innerWidth / 2;
    let y = window.innerHeight / 2;
    const speed = 3;
    let vx = 0, vy = 0;

    // Allow color change
    colorPicker.addEventListener('input', e => {
      player.style.backgroundColor = e.target.value;
      localStorage.setItem('playerColor', e.target.value);
    });

    // Restore saved color
    const savedColor = localStorage.getItem('playerColor');
    if (savedColor) {
      player.style.backgroundColor = savedColor;
      colorPicker.value = savedColor;
    }

    function updatePlayerPosition() {
      x += vx;
      y += vy;
      x = Math.max(0, Math.min(x, window.innerWidth - 40));
      y = Math.max(0, Math.min(y, window.innerHeight - 40));
      player.style.left = x + 'px';
      player.style.top = y + 'px';
      checkCollision();
    }

    function randomColor() {
      const colors = ['green', 'blue', 'yellow', 'purple', 'black'];
      return colors[Math.floor(Math.random() * colors.length)];
    }

    function createDot() {
      const dot = document.createElement('div');
      dot.classList.add('dot');
      dot.style.backgroundColor = randomColor();
      dot.style.left = Math.random() * (window.innerWidth - 20) + 'px';
      dot.style.top = Math.random() * (window.innerHeight - 20) + 'px';
      gameArea.appendChild(dot);
    }

    function createTrap() {
      const trap = document.createElement('div');
      trap.classList.add('trap');
      trap.style.left = Math.random() * (window.innerWidth - 20) + 'px';
      trap.style.top = Math.random() * (window.innerHeight - 20) + 'px';
      gameArea.appendChild(trap);
    }

    function checkCollision() {
      const items = document.querySelectorAll('.dot, .trap');
      const playerRect = player.getBoundingClientRect();

      items.forEach(item => {
        const rect = item.getBoundingClientRect();
        const isCollision = !(
          rect.right < playerRect.left ||
          rect.left > playerRect.right ||
          rect.bottom < playerRect.top ||
          rect.top > playerRect.bottom
        );
        if (isCollision) {
          if (item.classList.contains('trap')) {
            userScore = Math.max(0, userScore - 100);
          } else {
            userScore += 1;
            createDot(); // spawn another dot
          }
          item.remove();
          localStorage.setItem('userScore', userScore);
          scoreDisplay.textContent = `üåü ${userScore}`;
        }
      });
    }

    // Joystick logic
    let originX, originY;
    joystickWrapper.addEventListener('touchstart', (e) => {
      const touch = e.touches[0];
      originX = touch.clientX;
      originY = touch.clientY;
    });

    joystickWrapper.addEventListener('touchmove', (e) => {
      e.preventDefault();
      const touch = e.touches[0];
      const dx = touch.clientX - originX;
      const dy = touch.clientY - originY;
      const distance = Math.min(40, Math.sqrt(dx * dx + dy * dy));
      const angle = Math.atan2(dy, dx);

      const offsetX = Math.cos(angle) * distance;
      const offsetY = Math.sin(angle) * distance;

      joystickHandle.style.transform = `translate(${offsetX}px, ${offsetY}px)`;

      vx = Math.cos(angle) * speed;
      vy = Math.sin(angle) * speed;
    });

    joystickWrapper.addEventListener('touchend', () => {
      vx = 0;
      vy = 0;
      joystickHandle.style.transform = 'translate(0,0)';
    });

    // Initialize game
    setInterval(updatePlayerPosition, 20);
    for (let i = 0; i < 15; i++) createDot();
    for (let i = 0; i < 5; i++) createTrap();
    document.getElementById('exitButton').addEventListener('click', () => {
  window.location.href = 'index.html';
});

  </script>
</body>
</html>
